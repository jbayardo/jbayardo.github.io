<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>NCH is roto-translation invariant | Julian through the Lens</title>
<meta property='og:title' content='NCH is roto-translation invariant - Julian through the Lens'><meta property='og:description' content='Introduction I have recently started my thesis on 3D surface reconstruction. One way to do so is to define a surface as the zero level set of a function $f : \mathbb{R}^3 \to \mathbb{R}$, and then find some way to build this function out of a set of points $\mathcal{P} \subset \mathbb{R}^3$. NCH is a method that allows you to define such a function starting from a point cloud along with their normals, which tell you which way is the inside of the surface.'><meta property='og:url' content='https://julian.bayardo.info/post/nch-roto-translation-invariant/'><meta property='og:site_name' content='Julian through the Lens'><meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/fdbc036a46f3c0903c7e39459db599c0?s=256'><meta property='article:section' content='Post'><meta property='article:tag' content='thesis'><meta property='article:tag' content='non-convex hull'><meta property='article:tag' content='linear-algebra'><meta property='article:published_time' content='2018-08-20T19:23:28-03:00'><meta property='article:modified_time' content='2018-08-20T19:23:28-03:00'><meta name=twitter:card content='summary'><meta name=twitter:site content='@BayardoJulian'><meta name=twitter:creator content='@BayardoJulian'><link rel=alternate type=application/rss+xml title="Julian through the Lens" href=/post/index.xml><link rel=stylesheet href=/css/style.min.572ee845ad8da3c5d2a0a9e157da4b896325fafa6ff5b9b18ae122044000e00e.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://julian.bayardo.info/post/nch-roto-translation-invariant/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><header class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://julian.bayardo.info/><h1 id=nav-heading class="title is-4">Julian through the Lens</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/jbayardo target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</i></span></a><a class=level-item aria-label=email href=mailto:julian@bayardo.info target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/jbayardo target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922H1.468748v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a></nav></div></nav><nav class=nav><div class=nav-left><a class=nav-item href=/search><h2 class="title is-5">Search</h2></a><a class=nav-item href=/series><h2 class="title is-5">Series</h2></a><a class=nav-item href=/tags><h2 class="title is-5">Tags</h2></a></div><div class=nav-right><a class=nav-item href=/about><h2 class="title is-5">About me</h2></a><a class=nav-item href=/resume.html><h2 class="title is-5">Resume</h2></a></div></nav></div><script src=/js/navicon-shift.min.c7620c1a856fc9aead68a6e5fa7d6a739ac88b0ef5eb6834fb6dacf7dc82adc3.js integrity="sha256-x2IMGoVvya6taKbl+n1qc5rIiw7162g0+22s99yCrcM=" crossorigin=anonymous async defer></script></header><section class="section article-section"><article class=article data-pagefind-body><div class=article-container><div class=container><div class="subtitle tags is-6 is-pulled-right"><a class="tag is-6 is-link" href=/tags/thesis data-pagefind-filter=tag><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
thesis</a>
<a class="tag is-6 is-link" href=/tags/non-convex-hull data-pagefind-filter=tag><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
non-convex hull</a>
<a class="tag is-6 is-link" href=/tags/linear-algebra data-pagefind-filter=tag><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
linear-algebra</a></div><h2 class="subtitle is-6" data-pagefind-meta=date>August 20, 2018</h2><h1 class=title data-pagefind-meta=title>NCH is roto-translation invariant</h1><div class="content article"><nav class="table-of-contents boxed"><h2 class=title>Table of Contents</h2><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#definitions>Definitions</a></li><li><a href=#rotation-invariance>Rotation Invariance</a></li><li><a href=#translation-invariance>Translation Invariance</a></li><li><a href=#why-does-this-work>Why does this work?</a></li></ol></nav></nav><h1 id=introduction>Introduction
<a href=#introduction style=float:right;border-bottom:0><svg width="16" height="16" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5.0 10.69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04.0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5.0 10-.5.88s.34.22.84.25 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04.0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59c-.78.78-.78 2.04.0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5.0 10-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04.0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5.0 10.44-.88s-.34-.2-.84-.22z"/></svg></a></h1><p>I have recently started my thesis on 3D surface reconstruction. One way to do so is to define a surface as the zero level set of a function $f : \mathbb{R}^3 \to \mathbb{R}$, and then find some way to build this function out of a set of points $\mathcal{P} \subset \mathbb{R}^3$. <a href=http://mesh.brown.edu/nch/Taubin-sga2013-brief.pdf>NCH</a> is a method that allows you to define such a function starting from a point cloud along with their normals, which tell you which way is the inside of the surface.</p><p>The NCH algorithm is ashtonishingly simple: it took me an afternoon to implement and see it working with no previous experience in 3D whatsoever (using the <a href=https://github.com/PointCloudLibrary/pcl>PCL</a>&nbsp;<img src=/img/logos/github.svg alt="Site Logo" style=height:1em;vertical-align:middle;margin-right:5px>, of course!). However, it has two big shortcomings: finding $f$ is $\mathcal{O}(n^2)$, and evaluating $f$ at any point is $\mathcal{O}(n)$; this makes it a really expensive algorithm, considering that most surfaces are well into the many thousands of points.</p><p>If you read the paper, it will be clear that it is so simple there is no obvious way to reduce the amount of computation it has to do while also preserving the good theoretical properties it has. The objective of my thesis is quite undefined for now, but it will be about simplification: finding ways to cut down the number of points that you have to feed to the algorithm, in order to make it feasible to run it on larger point clouds.</p><p>Whatever I end up doing, I will certainly be using this blog as an archive of proofs and whatever interesting things I learn throughout, with the hope that by the day I have to sit down and write my thesis I will at least have some stuff already written down, or at least a clearer picture.</p><p>What follows is the first proof I made, which fills a gap the paper does not, namely, proving that the algorithm is insensitive to rotation and translation of the points it is given.</p><h1 id=definitions>Definitions
<a href=#definitions style=float:right;border-bottom:0><svg width="16" height="16" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5.0 10.69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04.0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5.0 10-.5.88s.34.22.84.25 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04.0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59c-.78.78-.78 2.04.0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5.0 10-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04.0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5.0 10.44-.88s-.34-.2-.84-.22z"/></svg></a></h1><p>Let $\\{p_1, ..., p_N\\}$ be a finite set of points with associated unit length orientation vectors $\\{n_1, ..., n_N\\}$. Let</p><script type="math/tex;mode=display">f(x) = \max_{1 \leq i \leq N} f_i(x)
</script><p>Be the NCH signed distance function (the one whose 0 level set is the surface we want to find), with</p>$$f_i(x) = n_i^t (x - p_i) - \rho_i || x - p_i ||^2$$<p>The corresponding basis functions for each point, with the parameter $\rho_i \geq 0$ defined as:</p>$$\rho\_i = \max_{j \in J_i} \frac{n_i^t (p_j - p_i)}{||p_j - p_i||^2}$$<p>Where $J_i = \\{j : n_i^t (p_j - p_i) > 0\\}$</p><h1 id=rotation-invariance>Rotation Invariance
<a href=#rotation-invariance style=float:right;border-bottom:0><svg width="16" height="16" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5.0 10.69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04.0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5.0 10-.5.88s.34.22.84.25 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04.0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59c-.78.78-.78 2.04.0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5.0 10-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04.0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5.0 10.44-.88s-.34-.2-.84-.22z"/></svg></a></h1><p>Let $p_i' = Q p_i$ and $n_i' = Q n_i$ with $Q$ an orthogonal matrix, and $f', f_i', \rho_i'$ defined as above. Then, if we look at the $\rho_i'$ estimation:</p><p>\begin{align}
\rho_i&rsquo; & = \max_{j \in J_i&rsquo;} \frac{n_i&rsquo;^t (p_j&rsquo; - p_i&rsquo;)}{|| p_j&rsquo; - p_i&rsquo;||^2} \\\
& = \max_{j \in J_i&rsquo;} \frac{n_i ^t Q^t Q (p_j - p_i)}{|| Q (p_j - p_i) ||^2} \\\
& = \max_{j \in J_i&rsquo;} \frac{n_i ^t (p_j - p_i)}{|| p_j - p_i ||^2}
\end{align}</p><p>Furthermore, if we look at the set $J_i'$:</p><p>\begin{align}
J_i&rsquo; & = \{j : n_i&rsquo;^t (p_j&rsquo; - p_i&rsquo;) > 0\} \\\
& = \{j : n_i^t Q^t Q (p_j - p_i) > 0\} \\\
& = \{j : n_i^t (p_j - p_i) > 0\} \\\
& = J_i
\end{align}</p><p>Which implies that $\rho\_i' = \rho\_i$. Finally, $f_i'(Qx)$:</p><p>\begin{align}
f_i&rsquo;(Qx) & = n_i&rsquo;^t (Qx - p_i&rsquo;) - \rho_i&rsquo; || Qx - p_i&rsquo; ||^2 \\\
& = n_i^t Q^t Q (x - p_i) - \rho_i || Q (x - p_i) ||^2 \\\
& = n_i^t (x - p_i) - \rho_i || x - p_i ||^2 \\\
& = f_i(x)
\end{align}</p><p>Thus, when we evaluate on a rotated point $Qx$, we get the guarantee that:</p>$$f'(Qx) = f(x)$$<h1 id=translation-invariance>Translation Invariance
<a href=#translation-invariance style=float:right;border-bottom:0><svg width="16" height="16" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5.0 10.69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04.0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5.0 10-.5.88s.34.22.84.25 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04.0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59c-.78.78-.78 2.04.0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5.0 10-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04.0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5.0 10.44-.88s-.34-.2-.84-.22z"/></svg></a></h1><p>The proof strategy here is all too similar to the previous case, the difference being that now our points are changed to $p_i' = p_i + c$, and $n_i' = n_i$. In this case, $p_j' - p_i' = p_j - p_i$ because the constant cancels out; this trivially implies that $J_i' = J_i$ and $\rho\_i' = \rho\_i$. Finally, the new guarantee that we are going to get is that:</p>$$f_i'(x + c) = f_i(x)$$<p>Derived out of $c$ canceling out in the sum, and finally:</p>$$f'(x + c) = f(x)$$<h1 id=why-does-this-work>Why does this work?
<a href=#why-does-this-work style=float:right;border-bottom:0><svg width="16" height="16" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5.0 10.69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04.0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5.0 10-.5.88s.34.22.84.25 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04.0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59c-.78.78-.78 2.04.0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5.0 10-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04.0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5.0 10.44-.88s-.34-.2-.84-.22z"/></svg></a></h1><p>Imagine $f(x) = 0$, that is, $x$ is in the zero level set of $f$ or, in practical terms, $x$ is a point that belongs to the border of the reconstructed surface. In the rotation case, this implies that</p>$$f'(Qx) = 0$$<p>Thus, the rotated point $Qx$ will be a part of the surface. In the case of a translation, we have that</p>$$f'(x + c) = 0$$<p>Which implies that the moved point $x + c$ is part of the surface. This of course works both ways, because of the equalities we established above.</p></div><div class=content data-pagefind-ignore=all><div class=boxed><h3>More in the "Non-Convex Hull" series</h3><ol class=unlist><li><span class="subtitle is-6">(August 21, 2018)</span> <a href=/post/nch-closing-the-gap/>NCH: closing the gap</a></li><li><span class="subtitle is-6">(August 20, 2018)</span> <strong><a href=/post/nch-roto-translation-invariant/>NCH is roto-translation invariant</a></strong></li></ol></div><br><div class=boxed><h3>Related Articles</h3><ol class=unlist><li><span class="subtitle is-6">(July 24, 2015)</span> <a href=/post/matrix-trace-characterization/>Characterizing the trace of a matrix</a></li></ol></div></div><button id=load-comments-button class="button is-primary is-active is-large is-fullwidth" style=display:none>Load Comments</button>
<script src=/js/comments.min.39e33edd67905b2b36477104baf1ec48ae8d66edab407617757a4adf0f6b75a0.js integrity="sha256-OeM+3WeQWys2R3EEuvHsSK6NZu2rQHYXdXpK3w9rdaA=" crossorigin=anonymous async defer></script></div></div></article></section><div class=top-button><a href=https://julian.bayardo.info/post/nch-roto-translation-invariant/#><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg></a></div><script src=/js/toc-highlight.min.e7ab37b0afc209abb07ffa8102b73d478c9b74c36c80593bdccc9793fc60adb5.js integrity="sha256-56s3sK/CCauwf/qBArc9R4ybdMNsgFk73MyXk/xgrbU=" crossorigin=anonymous async defer></script><footer class=section style=padding-top:0><div class=container><hr><p style=float:left>&copy; Julian Bayardo Spadafora 2015-2024</p><div style=float:right><a href=https://julian.bayardo.info/post/nch-roto-translation-invariant/#>Back to Top</a></div></div></footer><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[","]"]],processEscapes:!0,processEnvironments:!0,autoload:{color:[],colorV2:["color"]},packages:{"[+]":["noerrors"]}},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process",renderActions:{find_script_mathtex:[10,function(e){for(const t of document.querySelectorAll('script[type^="math/tex"]')){const o=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],o),s=document.createTextNode("");t.parentNode.replaceChild(s,t),n.start={node:s,delim:"",n:0},n.end={node:s,delim:"",n:0},e.math.push(n)}},""]}},loader:{load:["input/asciimath","[tex]/noerrors"]}}</script><script type=text/javascript id=MathJax-script async defer src=/js/vendor/mathjax/tex-mml-chtml.js></script></body></html>