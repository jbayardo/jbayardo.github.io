<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>NCH: closing the gap | Julian through the Lens</title>

<meta property='og:title' content='NCH: closing the gap - Julian through the Lens'>
<meta property='og:description' content='Introduction Following up with my last post on NCH being roto-translation invariant, the idea of this one is to cover what I consider the most important gaps left by the original brief paper. My expectation is that doing this will help understand better why NCH works, and hopefully gain some insight into how to improve it.
Equivalence of formulations Equation (4) in the paper says:
$$f_i^{r_i} (x) = \frac{1}{2 r_i} (r_i^2 - || x - (p_i &#43; r_i n_i) ||^2)$$'>
<meta property='og:url' content='https://julian.bayardo.info/posts/nch-closing-the-gap/'>
<meta property='og:site_name' content='Julian through the Lens'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/fdbc036a46f3c0903c7e39459db599c0?s=256'><meta property='article:section' content='Posts'><meta property='article:tag' content='thesis'><meta property='article:tag' content='non-convex hull'><meta property='article:tag' content='linear-algebra'><meta property='article:published_time' content='2018-08-21T01:10:11-03:00'/><meta property='article:modified_time' content='2018-08-21T01:10:11-03:00'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@'><meta name='twitter:creator' content='@'>
<link rel="stylesheet" href="/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>


<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://julian.bayardo.info/"><h1 class="title is-4">Julian through the Lens</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="email" href='mailto:julian@bayardo.info' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="github" href='https://github.com/jbayardo' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/jbayardo' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/thesis">#thesis</a>



  
  | <a class="subtitle is-6" href="/tags/non-convex-hull">#non-convex hull</a>
  
  | <a class="subtitle is-6" href="/tags/linear-algebra">#linear-algebra</a>
  

      
    </div>
    <h2 class="subtitle is-6">August 21, 2018</h2>
    <h1 class="title">NCH: closing the gap</h1>
    
    <div class="content">
      

<script src="https://cdn.plot.ly/plotly-1.36.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.1.0/math.min.js"></script>

<h1 id="introduction">Introduction</h1>

<p>Following up with my last post on <a href="/posts/nch-roto-translation-invariant/">NCH being roto-translation invariant</a>, the idea of this one is to cover what I consider the most important gaps left by the original brief paper. My expectation is that doing this will help understand better why NCH works, and hopefully gain some insight into how to improve it.</p>

<h1 id="equivalence-of-formulations">Equivalence of formulations</h1>

<p>Equation (4) in the paper says:</p>

<p>$$f_i^{r_i} (x) = \frac{1}{2 r_i} (r_i^2 - || x - (p_i + r_i n_i) ||^2)$$</p>

<p>However, the definition used in (2) is slightly different. Where does (2) come from? from expanding inner products in the second term of the sum:</p>

<p>\begin{align}
|| x - (p_i + r_i n_i) ||^2 &amp; = \langle x - p_i - r_i n_i, x - p_i - r_i n_i \rangle \\<br />
&amp; = \langle x - p_i, x - p_i \rangle + \langle x - p_i, -r_i n_i \rangle + \langle -r_i n_i, x - p_i \rangle + \langle -r_i n_i, -r_i n_i \rangle \\<br />
&amp; = || x - p_i ||^2 + (-2 r_i) \langle n_i, x - p_i \rangle + r_i^2
\end{align}</p>

<p>Thus, when you replace in the original definition:</p>

<p>\begin{align}
f_i^{r_i} (x) &amp; = \frac{1}{2 r_i} (r_i^2 - (|| x - p_i ||^2 + (-2 r_i) \langle n_i, x - p_i \rangle + r_i^2)) \\<br />
&amp; = \frac{1}{2 r_i} (- || x - p_i ||^2 + (2 r_i) \langle n_i, x - p_i \rangle) \\<br />
&amp; = \langle n_i, x - p_i \rangle - \frac{1}{2 r_i} || x - p_i ||^2
\end{align}</p>

<p>Which is exactly what we wanted</p>

<h1 id="fantastic-rho-i-s-and-where-to-find-them">Fantastic $\rho_i$s and where to find them</h1>

<p>In equation (3), the author says what the value of $\rho_i$ should be. He later defines $r_i$ as the largest value of $r$ such that $f_i^r (p_j) \leq 0 \forall p_j \in \mathcal{P}, j \neq i$. If you actually write it out:</p>

<p>$$
0 \geq f_i^r (p_j) = \langle n_i, p_j - p_i \rangle - \frac{1}{2 r_i} || p_j - p_i ||^2
$$</p>

<p>And thus</p>

<p>$$
\frac{1}{2 r_i} \geq \frac{ \langle n_i, p_j - p_i \rangle }{ || p_j - p_i ||^2 }
$$</p>

<p>If you gather the contraints for all $p_j$s together, then you have that</p>

<p>$$
\rho_i \geq \max_{p_j \in \mathcal{P}, i \neq j} \frac{ \langle n_i, p_j - p_i \rangle }{ || p_j - p_i ||^2 }
$$</p>

<p>And we further need that $\rho_i \geq 0$ in the case the supporting set actually ends up being just the linear half space (as should happen when fitting planes, for example).</p>

<h1 id="rho-s-and-theta-s">$\rho$s and $\theta$s</h1>

<p>One interesting thing to notice out of the estimation of $\rho$ is that (in non-standard notation, but good enough for understanding):</p>

<p>\begin{align}
\rho_i &amp; = \max_{p_j \in \mathcal{P}, i \neq j} \{ 0, \frac{\langle n_i, p_j - p_i \rangle}{|| p_j - p_i ||^2} \} \\<br />
&amp; = \max_{p_j \in \mathcal{P}, i \neq j} \{ 0, \frac{1}{|| p_j - p_i ||} \langle n_i, \frac{p_j - p_i}{|| p_j - p_i ||} \rangle \} \\<br />
&amp; = \max_{p_j \in \mathcal{P}, i \neq j} \{ 0, \frac{\text{cos_sim} (n_i, p_j - p_i)}{|| p_j - p_i ||} \} \\<br />
\end{align}</p>

<p>Where $\text{cos_sim}$ denotes the <a href="https://en.wikipedia.org/wiki/Cosine_similarity">cosine similarity</a> between the two vectors; i.e. the angle between them. For the following plots, I have set $p_i = (1, 1)$ and $n_i = (1, 0)$, and plotted the component in the maximum above for the given points (notice $p_i$ is NOT included in the plot, for obvious reasons), as well as the cosine similarity:</p>

<div id="rho-component-plot"></div>

<div id="cosine-similarity-plot"></div>

<p>Results are as you would expect: towards the outside of the surface (i.e. in the inverse direction as the normal) we get negative values, and towards the inside we get positive. However, contribution of a point to the maximum decreases really fast as you move away from the center point, because the cosine similarity is bounded between $-1$ and $1$, while the distance it is divided by can be arbitrarily large.</p>

<p>This may be an interesting way to construct an heuristic to speed up NCH: process only the $O(\sqrt N)$ points that are closest when computing the rho.</p>

<script type="text/javascript">
  function generateCosineSimilarityData(n_i, p_i, start, end, resolution, delta_normed=false) {
    xs = [];
    ys = [];
    zs = [];
    for (var x = start; x < end; x += resolution) {
      for (var y = start; y < end; y += resolution) {
        xs.push(x);
        ys.push(y);

        var p = math.matrix([x, y]);
        if (math.deepEqual(p_i, p)) {
          // Skip the center point.
          continue;
        }

        var delta = math.subtract(p, p_i);
        var normalized_delta = math.divide(delta, math.norm(delta));
        var similarity = math.dot(n_i, normalized_delta);
        if (delta_normed) {
          similarity = math.divide(similarity, math.norm(delta));
        }

        zs.push(similarity);
      }
    }

    return {
      xs: xs,
      ys: ys,
      zs: zs
    }
  }

  function drawCosineSimilarityHeatmap(identifier, delta_normed) {
    var n_i = math.matrix([1, 0]);
    n_i = math.divide(n_i, math.norm(n_i));

    var p_i = math.matrix([1, 1]);
    var data = generateCosineSimilarityData(n_i, p_i, -4, 6, 0.1, delta_normed);

    var title = 'Cosine Similarity';
    if (delta_normed) {
      title = 'Rho Estimate';
    }

    Plotly.plot(identifier, {
      data: [{
        x: data.xs,
        y: data.ys,
        z: data.zs,
        type: 'heatmap'
      }],
      layout: {
        title: title,
        width: 500,
        height: 500
      }
    });
  }

  drawCosineSimilarityHeatmap('rho-component-plot', true);
  drawCosineSimilarityHeatmap('cosine-similarity-plot', false);
</script>

      
    </div>
    
  </div>
</section>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

